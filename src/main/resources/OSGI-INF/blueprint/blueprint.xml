<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <bean id="bindyDataformat" class="org.apache.camel.dataformat.bindy.csv.BindyCsvDataFormat">
        <argument value="de.gzockoll.osgi.raumklima.Sht21Data" />
    </bean>

    <bean id="aggregatorStrategy" class="de.gzockoll.osgi.raumklima.StringBodyAggregator"/>

    <camelContext xmlns="http://camel.apache.org/schema/blueprint" trace="true" streamCache="false">
        <dataFormats>
            <xstream id="xstream-utf8" encoding="UTF-8"/>
            <xstream id="xstream-default"/>
            <xmljson id="xmljson"/>
            <json id="json" library="Gson" />
        </dataFormats>
        <route>
            <from uri="jetty:http://0.0.0.0:11145/klima/json"/>
            <to uri="seda:exec-sht21"/>
            <unmarshal ref="bindyDataformat"/>
            <marshal ref="json"/>
            <to uri="log:data"/>
        </route>
        <route>
            <from uri="seda:exec-sht21"/>
            <to uri="exec:/home/pi/wrk/Raspi-SHT21-V3_0_0/sht21?args=S"/>
        </route>
        <route>
            <from uri="direct:simulator1"/>
            <unmarshal ref="bindyDataformat"/>
            <to uri="log:test?showAll=true&amp;multiline=true"/>
            <marshal ref="json"/>
            <to uri="log:test?showAll=true&amp;multiline=true"/>
            <to uri="mock:result"/>
        </route>
        <route>
            <from uri="timer://foo?fixedRate=true&amp;period=60000"/>
            <to uri="direct:start"/>
        </route>
        <route>
            <from uri="direct:start"/>
            <multicast strategyRef="aggregatorStrategy">
                <to uri="direct:indoor"/>
                <to uri="direct:weather"/>
            </multicast>
            <to uri="log:test?showAll=true&amp;multiline=true"/>
            <to uri="direct:homematic"/>
        </route>
        <route>
            <from uri="direct:weather"/>
            <to uri="weather:foo?location=Henstedt-Ulzburg,Germany"/>
            <unmarshal ref="xmljson"/>
            <to uri="xslt:weather.xsl"/>
        </route>
        <route>
            <from uri="direct:indoor"/>
            <setHeader headerName="CamelFileName">
                <constant>sht21.txt</constant>
            </setHeader>
            <setExchangePattern pattern="InOut"/>
            <to uri="seda:exec-sht21"/>
            <transform>
                <simple>0 ${in.body}</simple>
            </transform>
        </route>
        <route>
            <from uri="direct:homematic"/>
            <to uri="sftp:root@homematic-ccu2//var/tmp?privateKeyFile=/home/pi/.ssh/id_dsa"/>
            <to uri="log:test?showAll=true&amp;multiline=true"/>
        </route>
    </camelContext>
</blueprint>
